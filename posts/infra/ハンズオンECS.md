---
id: d069f6d5-7be8-04e0-d7f8-0ab717449723
title: ECSをハンズオンで作成してみる
date: '2025-05-17'
tags:
  - AWS
  - ECS
  - コンテナオーケストレータ
  - ハンズオン
---
# ECSをハンズオンで作成してみる

今回はECS環境をハンズオンで作成していく。

## VPCとSubnetを作成する

VPCを10.0.0.0/20 (10,0.0.0~10.0.12.255)

Subnet-1 10.0.0.0/24(10.0.0.0~10.0.0.0.255)

Subnet-2 10.0.1.0/24(10.0.1.0~10.0.0.1.255)

の範囲で作成していく

リージョンはAsia/Tokyoとする(ap-northeast-1)

### Step1.AWSマネジメントコンソールからVPCを作成する

AWSマネジメントコンソールにログインし、VPCを検索して選択する。

初めての利用の場合はデフォルトのVPCが存在するため、削除する(放っておいても良い)

![VPCコンソール画面](images/aws_vpc_top.png)

右上からVPCの作成を選択して新規作成画面へ遷移する

作成するリソースは今回はVPCのみとする(VPCなどは関連するリソースも作成可能なため、こちらの方が楽ではある)

名前タグにはmy-vpcを入力

IPv4 CIDRブロックは手動入力。IPv4 CIDRに、10.0.0.0/20を入力

IPv6は今回不要

テナンシーはデフォルトとする

テナンシーはシングルテナント専用のハードウェアであり、ハードウェアを専有してしてVPCを構築することなる。よって、ハードウェアの利用料も支払い対象となる。セキュリティ的にハードウェアを他のユーザーと共有したくない場合やオンプレ向けなライセンスを持ち込みたい時などで使用する

![VPC作成画面](images/aws_vpc_create.png)

VPCが作成されたため、次はSubnetの作成を行なっていく

### Step.2 Subnetの作成

publicサブネットとprivateサブネットを作成していく

VPCダッシュボードのサブネットを選択する

VPCを削除していない場合はここにデフォルトのサブネットがあるが、別で作成していく。(デフォルトのVPCを削除していれば何もないはず。あっても更新すれば消えるか、再度削除してみればエラーになり、再更新すると消える)

まずはprivateサブネットを作成していく

サブネットの作成からVPC IDで先ほど、作成したVPCを選択

サブネット名にmy-subnet-app-private1-a

アベイラビリティゾーン(AZ)はap-northeast-1a

IPv4 VPC CIDRブロックは10.0.0.0/20

IPv4サブネット CIDRブロックは 10.0.0.0/24とする(サブネットはVPCに内包されるため、VPCのIPアドレスの範囲内のみ選択可能)

サブネットを作成を選択

![Subnet作成画面](images/aws_vpc_subnet_create.png)

次はpublicサブネットを作成していく

サブネットの作成からVPC IDで先ほど、作成したVPCを選択

サブネット名にmy-subnet-app-public1-a

アベイラビリティゾーン(AZ)はap-northeast-1a

IPv4 VPC CIDRブロックは10.0.0.0/20

IPv4サブネット CIDRブロックは 10.0.1.0/24とする(サブネットはVPCに内包されるため、VPCのIPアドレスの範囲内のみ選択可能)

サブネットを作成を選択

本来は、アベイラビリティーゾーンを変更して冗長性を考慮してサブネットを作成することが望ましい。(publicをAZ跨いで2つ作成。privateも然り。)

今回はpublicとprivateで役割の違うサブネットを1のAZで作成した。

これでサブネットの作成は完了である。

### Step3 ルートテーブルとIGWの作成

ルートテーブルは基本的にサブネットに紐つけて作成されることとなり、通信のルートを定義しているものとなる。

インターネットゲートウェイはサブネット内で発生した通信の内、自身のサブネット内の機器ではなく、インターネットへの接続が必要な場合に使用する。今回で言うとpublicなサブネットを先ほど作成したので、そこへアタッチすることとなる。

早速、VPCダッシュボードのルートテーブルを選択し、新規作成を選択する

![ルートテーブルトップ画面](images/aws_vpc_route_table_top.png)

ルートテーブルの作成を選択し、まずはprivateサブネットにアタッチするルートテーブルを作成する。

名前：my-route-table-private1-a

VPC: 先ほど作成したVPC(my-vpc)

でルートテーブルを作成する

![ルートテーブル作成画面](images/aws_vpc_route_table_create.png)

続いて、同様にpublicサブネットにアタッチするルートテーブルを作成する。

名前：my-route-table-public1-a

VPC: 先ほど作成したVPC(my-vpc)

でルートテーブルを作成する

pulicルートテーブル向けにインターネットゲートウェイを作成する

VPCダッシュボードからインターネットゲートウェイを選択する

![igwのtop画面](images/aws_vpc_igw_top.png)

インターネットゲートウェイの作成を選択し、名前を入力して作成をする

名前タグ: my-igw

![igwの作成画面](images/aws_vpc_igw_create.png)

インターネットゲートウェイの一覧に戻ると、状態がDetachedになっているはずです。

なのでここからアタッチしていきます。

先ほど作成したmy-igwを選択して、VPCにアタッチを選択する。

![igwのアタッチ選択状態画面](images/aws_vpc_igw_attach.png)

設定画面からアタッチが完了すると、VPCはインターネットゲートウェイを通じて外の通信が可能となる状態を作成できるようになる。

では実際に、ルートテーブルを編集し、インターネットゲートウェイを選択していく。

VPCダッシュボードからルートテーブルに戻り、my-subnet-app-public1-aを選択し、画面下部に出る、メニューからルートテーブルを選択する。

![ルートテーブルにigwをアタッチするメニュー](images/aws_vpc_route_table_attach_igw.png)

ルートを編集を選択して、ルートを追加する。
送信先: 全ての通信を意味する 0.0.0.0/0(全てが該当する場合は一致しているものが優先される->10.0.0.0/20はlocalが優先される)

ターゲット: インターネットゲートウェイと先ほど作成したインターネットゲートウェイを選択する。

![ルートテーブルにigwをアタッチする](images/aws_vpc_route_table_attach_igw_view.png)

これで、ルートテーブルにインターネットゲートウェイが関連付けされた。

あとはここからサブネットにルートテーブルを設定して、準備は完了となる。

まずはpublicなサブネットに対し、ルートテーブルを設定していく

VPCダッシュボードからサブネットを選択し、my-subnet-app-public1-aを選択する。

画面下部のメニューからルートテーブルを選択して、ルートテーブルの関連付けを編集を選択

![サブネットからルートテーブルメニューを選択する](images/aws_vpc_subnet_attach_route_table_menu.png)

ルートテーブルID: my-route-table-public1-a

保存する。

同様にprivateなサブネットに対してもルートテーブルを設定していく。

ここまでで、ECSの下準備は完了した。
